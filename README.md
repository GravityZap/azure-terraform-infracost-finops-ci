# Azure Terraform Infracost FinOps CI

This repository demonstrates how to integrate **Terraform, Microsoft Azure and Infracost** into CI pipelines to automatically estimate infrastructure costs and make cloud cost impact visible directly in pull requests.

The project focuses on **DevOps / Platform Engineering practices** with a strong emphasis on **FinOps and cost-aware infrastructure design**.

---

## ğŸ” What is this project?

A production-inspired example of:

- Azure infrastructure defined with Terraform  
- automated cost estimation using Infracost  
- CI pipelines implemented in:
  - GitHub Actions  
  - Azure DevOps Pipelines  
- multiple infrastructure scenarios with different cost profiles  

The primary goal is to make **cloud cost impact visible before deployment**, directly at pull request stage.

---

## â— Why this matters

In many real-world projects:

- infrastructure cost is not reviewed in pull requests  
- teams discover overspending only after receiving the cloud bill  
- architectural decisions are made without cost feedback  

This repository introduces a **FinOps feedback loop** into CI/CD:

> Pull request â†’ Terraform plan â†’ Cost estimation â†’ Cost report

This approach enables teams to:

- detect expensive changes early  
- compare architectural options  
- build cost-aware engineering culture  

---

## ğŸ§  How it works

1. A pull request is created with Terraform changes  
2. CI pipelines automatically run:
   - `terraform init`
   - `terraform plan`
3. Infracost analyzes the Terraform plan and estimates monthly cost  
4. The pipeline publishes a cost report:
   - GitHub Actions â†’ automatic PR comment  
   - Azure DevOps â†’ pipeline logs  

No infrastructure is deployed as part of this project.

---

## ğŸ§ª Infrastructure scenarios

The repository contains multiple Terraform scenarios designed to demonstrate how architectural and scaling decisions affect monthly Azure cost.

| Scenario      | Description |
|---------------|-------------|
| cheap         | Minimal dev/test setup with low monthly cost  
| expensive     | Intentionally oversized architecture  
| autoscaling   | Production-like setup with autoscaling and monitoring  

Each scenario uses the same core modules but different SKUs, scaling rules and optional services.

---

## ğŸ— Repository structure

![Structure screenshot](imaages/folders_structure.png)


---

## ğŸ¤– CI pipelines

### GitHub Actions
- triggered on pull requests  
- runs Terraform plan for all scenarios  
- generates cost breakdowns using Infracost  
- posts an automatic comment with monthly cost diff  

### Azure DevOps Pipelines
- triggered on pull requests  
- executes Terraform and Infracost  
- shows cost estimation directly in pipeline logs  

This demonstrates how the same FinOps workflow can be implemented across different CI platforms.

---

## ğŸ“¸ Example output

Below is an example of an automatic pull request comment generated by the CI pipeline using Infracost:

```md
## ğŸ’° Infracost estimate

Monthly cost change detected across infrastructure scenarios.

### ğŸ“¦ cheap-scenario
Previous monthly cost: $18.42  
New monthly cost: $22.67  
Diff: **+$4.25 / month**

### ğŸ“¦ expensive-scenario
Previous monthly cost: $104.30  
New monthly cost: $186.95  
Diff: **+$82.65 / month**

### ğŸ“¦ autoscaling-scenario
Previous monthly cost: $128.10  
New monthly cost: $241.80  
Diff: **+$113.70 / month**

---

### ğŸ“Š Summary

Total monthly cost change: **+$200.60 / month**

Key drivers:
- App Service Plan upgraded from B1 to P1v3  
- Application Insights and Log Analytics enabled  
- Autoscaling configured (1 â†’ 3 instances)

---

_This cost estimate is automatically generated from the Terraform plan using Infracost._
